\begin{code}[hide]%
\>[0]\AgdaComment{--\ Cannot\ be\ safe\ because\ we\ postulate\ funext}\<%
\\
\>[0]\AgdaComment{--\ \{-\#\ OPTIONS\ --safe\ \#-\}}\<%
\\
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{2-overview}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Agda.Primitive}\AgdaSpace{}%
\AgdaKeyword{renaming}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaPrimitive{Setω}\AgdaSpace{}%
\AgdaSymbol{to}\AgdaSpace{}%
\AgdaPrimitive{Typeω}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Function.Properties.Equivalence}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{⇔}\<%
\\
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Bool}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{Bool}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Bool}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{Bool}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{true}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{false}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Char}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPostulate{Char}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≟\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.List}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{List}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{foldl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Empty}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Sum}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{Sum}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Unit}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≟\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary.Decidable}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{Dec}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{from-yes}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{from-no}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary.Reflects}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ofʸ}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{ofⁿ}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Level}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{zero}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaPrimitive{suc}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Function}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Fin}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≟\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\AgdaSpace{}%
\AgdaKeyword{hiding}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≟\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary.Negation}\<%
\\
\>[0]\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.String}\AgdaSpace{}%
\AgdaSymbol{as}\AgdaSpace{}%
\AgdaModule{String}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Agda.Builtin.FromString}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{transport}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
\>[0]\AgdaFunction{transport}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{≡→⇔}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
\>[0]\AgdaFunction{≡→⇔}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{lift⊎₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{C}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊎}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊎}}\AgdaSpace{}%
\AgdaBound{D}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{C}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊎}}\AgdaSpace{}%
\AgdaBound{D}\<%
\\
\>[0]\AgdaFunction{lift⊎₂}\AgdaSpace{}%
\AgdaBound{f}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{f}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{lift⊎₂}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\AgdaFunction{lift⊎₂}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{String}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
\>[0]\AgdaFunction{String}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaPostulate{Char}\<%
\\
\>[0]\AgdaKeyword{instance}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaFunction{string}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{IsString}\AgdaSpace{}%
\AgdaFunction{String}\<%
\\
%
\>[2]\AgdaField{IsString.Constraint}\AgdaSpace{}%
\AgdaFunction{string}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{⊤}\<%
\\
%
\>[2]\AgdaField{IsString.fromString}\AgdaSpace{}%
\AgdaFunction{string}\AgdaSpace{}%
\AgdaBound{xs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPrimitive{String.toList}\AgdaSpace{}%
\AgdaBound{xs}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{foldl}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ℓ₁}\AgdaSpace{}%
\AgdaBound{ℓ₂}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ℓ₁}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ℓ₂}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
\>[0]\AgdaFunction{foldl}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{z}\<%
\\
\>[0]\AgdaFunction{foldl}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{z}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{foldl}\AgdaSpace{}%
\AgdaBound{k}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{k}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{z}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{variable}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaGeneralizable{ℓ}\AgdaSpace{}%
\AgdaGeneralizable{ℓ′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\<%
\\
%
\>[4]\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaGeneralizable{ℓ}\<%
\\
%
\>[4]\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaGeneralizable{c'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\<%
\\
%
\>[4]\AgdaGeneralizable{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\<%
\end{code}

\section{Languages and Parsers}

In this section, we introduce background information, namely how we define languages, basic language combinators, and parsers. Our exposition follows Elliot~\cite{conal-languages}. In \cref{sec:context-free}, we extend these concepts to context free languages.

\subsection{Languages}

We define languages as being functions from strings to types.\footnote{We use \af{Type} as a synonym for Agda's \af{Set} to avoid confusion.}
\begin{code}[hide]%
\>[0]\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type₁}\<%
\end{code}
\begin{code}%
\>[0]\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\end{code}
The result type can be thought of as the type of proofs that the string is in the language.
\begin{remark}
Note that a language may admit multiple different proofs for the same string. That is an important difference between the type theoretic approach and the more common set theoretic approach, which models languages as sets of strings.
\end{remark}
This is a broad definition of what a language is; it includes languages that are outside the class of context-free languages. 
\begin{example}\label{ex:non-context-free}
The language $a^n b^n c^n$ can be specified as follows:
\begin{code}[hide]%
\>[0]\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{String}\<%
\\
\>[0]\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
\>[0]\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaBound{c}\<%
\end{code}
\begin{code}%
\>[0]\AgdaFunction{abc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
\>[0]\AgdaFunction{abc}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Σ[}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaFunction{∈}\AgdaSpace{}%
\AgdaDatatype{ℕ}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaString{'a'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{++}}\AgdaSpace{}%
\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaString{'b'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{++}}\AgdaSpace{}%
\AgdaFunction{repeat}\AgdaSpace{}%
\AgdaBound{n}\AgdaSpace{}%
\AgdaString{'c'}\<%
\end{code}
We can show that the string $aabbcc$ is in this language by choosing $n$ to be $2$, from which the required equality follows by reflexivity after normalization:
\begin{code}%
\>[0]\AgdaFunction{aabbcc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{abc}\AgdaSpace{}%
\AgdaString{"aabbcc"}\<%
\\
\>[0]\AgdaFunction{aabbcc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\end{code}
\end{example}
\cref{ex:non-context-free} shows that it is possible to specify languages and prove that certain strings are in those languages, but for practical applications we do not want to be burdened with writing such proofs ourselves. The compiler should be able to decide whether or not your program is valid by itself.

\begin{itemize}
\item Agda is too powerful: it can specify undecidable languages \jr{do I need to give an example?}
\item So, we need to define a simpler language which still supports all the features we need.
\end{itemize}

\subsection{Basic Language Combinators}

Let's start with a simple example: POSIX file system permissions. These are usually summarized using the characters `r', `w', and `x' if the permissions are granted, or `-' in place of the corresponding character if the permission is denied. For example the string ``r-x'' indicates that read and execute permissions are granted, but the write permission is denied. The full language can be expressed using the following BNF grammar:\jr{cite: BNF}

\begin{grammar}
<permissions>  ::= <read> <write> <execute>

<read>         ::= `-' | `r'

<write>        ::= `-' | `w'

<execute>      ::= `-' | `x'
\end{grammar}

\begin{code}[hide]%
\>[0]\AgdaKeyword{variable}\AgdaSpace{}%
\AgdaGeneralizable{ℒ}\AgdaSpace{}%
\AgdaGeneralizable{ℒ₁}\AgdaSpace{}%
\AgdaGeneralizable{ℒ₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{◇}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}

\begin{figure}
\begin{minipage}{.63\textwidth}
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaOperator{\AgdaFunction{`\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∪\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊎}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaBound{w}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∗\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{∃[}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaFunction{∃[}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{++}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaBound{v}\<%
\end{code}
\end{minipage}
\begin{minipage}{.36\textwidth}
\begin{code}%
%
\>[4]\AgdaFunction{∅}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaFunction{∅}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{ε}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaFunction{ε}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}·\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{w}\<%
\end{code}
\end{minipage}
\begin{code}[hide]%
%
\>[4]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{22}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{21}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∗\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{21}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}·\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{20}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∪\AgdaUnderscore{}}}\<%
\end{code}
\caption{Basic language combinators.}\label{fig:combinators}
\end{figure}

This grammar uses three important features: sequencing, choice, and matching character literals. We can define these features are combinators in Agda as shown in \cref{fig:combinators} and use them to write our permissions grammar as follows:

\begin{code}[hide]%
%
\>[4]\AgdaFunction{permissions}\AgdaSpace{}%
\AgdaFunction{read}\AgdaSpace{}%
\AgdaFunction{write}\AgdaSpace{}%
\AgdaFunction{execute}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{permissions}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{read}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaFunction{write}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaFunction{execute}\<%
\\
%
\>[4]\AgdaFunction{read}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'-'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'r'}\<%
\\
%
\>[4]\AgdaFunction{write}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'-'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'w'}\<%
\\
%
\>[4]\AgdaFunction{execute}%
\>[17]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'-'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'x'}\<%
\end{code}

\subsection{Parsers}

We want to write a program which can prove for us that a given string is in the language. What should this program return for strings that are not in the language? We want to make sure our program does find a proof if it exists, so if it does not exist then we want a proof that the string is not in the language. We can capture this using a type called \af{Dec} from the Agda standard library. It can be defined as follows:

\begin{code}%
%
\>[4]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{◂Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaInductiveConstructor{◂yes}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{◂Dec}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[8]\AgdaInductiveConstructor{◂no}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{◂Dec}\AgdaSpace{}%
\AgdaBound{A}\<%
\end{code}

A parser for a language, then, is a program which can tell us whether any given string is in the language or not.

\begin{code}%
%
\>[4]\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\<%
\\
%
\>[4]\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}

\begin{remark}
Readers familiar with Haskell might see similarity between this type and the type \verb|String -> Maybe a|, which is one way to implement parser combinators (although usually the return type is \verb|Maybe (a, String)| giving parsers the freedom to consume only a prefix of the input string and return the rest). The differences are that the result of our $\af{Parser}$ type depends on the language specification and input string, and that a failure carries with it a proof that the string cannot be part of the language. This allows us to separate the specification of our language from the implementation while ensuring correctness.
\end{remark}

\begin{remark}
Note that the \af{Dec} type only requires our parsers to produce a single result; it does not have to exhaustively list all possible ways to parse the input string. In Haskell, one might write \verb|String -> [(a, String)]|\jr{cite: monadic parser combinators}, which allows a parser to return multiple results but still does not enforce exhaustiveness. Instead, we could use:\jr{This should be explained in more detail}
%
\begin{itemize}
\item completely unique account of enumeration.
\item bijection with $\af{Fin}~\ab{n}$ for some $\ab{n}$ or $\af{Nat}$.
\end{itemize}
%
In this paper, however, we use $\af{Dec}$ to keep the presentation simple.
\end{remark}

To construct a parser for our permissions language, we start by defining parsers for each of the language combinators. Let us start by considering the character combinator. If the given string is empty or has more than one character, it can never be in a language formed by one character. If the string does consist of only one character, then it is in the language if that character is the same as from the language specification. In Agda, we can write such a parser for characters as follows:

\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{◂`-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{◂`-parse}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{◂`-parse}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{◂`-parse}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\end{code}

This is a correct implementation of a parser for languages that consist of a single character, but the implementation is hard to read and does not give much insight. Instead, we can factor this parser into two cases: the empty string case and the case where the string has at least one character. We call the former nullability and use the greek character $ν$ to signify it, and we call the latter derivative and use the greek character $δ$ to signify it. \Cref{fig:null-delta} shows how these cases can be defined and how they relate to the basic combinators. These properties motivate the introduction of three new basic combinators: guards $\af{_·_}$, the language consisting of only the empty string $\af{ε}$, and the empty language $\af{∅}$.\jr{This does not motivate the split into $ν$ and $δ$ well enough. Also, the new combinators can be motivated more clearly.}

\begin{code}[hide]%
%
\>[4]\AgdaKeyword{variable}\AgdaSpace{}%
\AgdaGeneralizable{L}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{⊥-dec}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaFunction{⊥}\<%
\\
%
\>[4]\AgdaFunction{⊥-dec}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{⊤-dec}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaRecord{⊤}\<%
\\
%
\>[4]\AgdaFunction{⊤-dec}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\<%
\end{code}

\begin{figure}
\begin{minipage}{0.45\textwidth}
\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ℓ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}◂⇔\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◂⇔}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{ν∅}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{⊥}%
\>[23]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaFunction{∅}\<%
\\
%
\>[4]\AgdaFunction{νε}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{⊤}%
\>[23]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaFunction{ε}\<%
\\
%
\>[4]\AgdaFunction{ν·}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSymbol{)}%
\>[23]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{ν`}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{⊥}%
\>[23]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaGeneralizable{c'}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{ν∪}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊎}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}%
\>[23]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{ν∗}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}%
\>[23]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
\>[0]\<%
\end{code}
\end{minipage}
\begin{minipage}{0.54\textwidth}
\begin{code}[hide]%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ℓ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSpace{}%
\AgdaBound{ℓ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}⟺\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Set}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{w}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaBound{w}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{δ∅}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{∅}%
\>[27]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaFunction{∅}\<%
\\
%
\>[4]\AgdaFunction{δε}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{∅}%
\>[27]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaFunction{ε}\<%
\\
%
\>[4]\AgdaFunction{δ·}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSymbol{)}%
\>[27]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ`}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaGeneralizable{c'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaFunction{ε}\AgdaSymbol{)}%
\>[27]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaGeneralizable{c'}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ∪}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}%
\>[27]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ∗}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaFunction{δ}%
\>[689I]\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
\>[.][@{}l@{}]\<[689I]%
\>[27]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\end{code}
\end{minipage}
\caption{Nullability, derivatives, and how they relate to the basic combinators.}\label{fig:null-delta}
\end{figure}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν∅}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\\
%
\>[4]\AgdaFunction{δ∅}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{∅-parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaFunction{∅}\<%
\\
%
\>[4]\AgdaFunction{∅-parse}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[21]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{ν∅}\AgdaSpace{}%
\AgdaFunction{⊥-dec}\<%
\\
%
\>[4]\AgdaFunction{∅-parse}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[21]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ∅}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{w}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{∅-parse}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{νε}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\AgdaSpace{}%
\AgdaSymbol{\})}\<%
\\
%
\>[4]\AgdaFunction{δε}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{())}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{ε-parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaFunction{ε}\<%
\\
%
\>[4]\AgdaFunction{ε-parse}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[21]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{νε}\AgdaSpace{}%
\AgdaFunction{⊤-dec}\<%
\\
%
\>[4]\AgdaFunction{ε-parse}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[21]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{δε}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{∅-parse}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{ν·}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\\
%
\>[4]\AgdaFunction{δ·}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}·-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaGeneralizable{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{A}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·}}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}·-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[35]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν·}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×-dec}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}·-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[35]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ·}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{P}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·-parse}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{ν`}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{())}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{())}\<%
\\
%
\>[4]\AgdaFunction{δ`}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{\})}\<%
\end{code}

Now the implementation of parsers for languages consisting of a single character follows completely from the decomposition into nullability and derivatives.

\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{`-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaBound{c'}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[26]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{ν`}\AgdaSpace{}%
\AgdaFunction{⊥-dec}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaBound{c'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[26]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{δ`}\AgdaSpace{}%
\AgdaSymbol{(((}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{c'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·-parse}}\AgdaSpace{}%
\AgdaFunction{ε-parse}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}

The implementation of $\af{·-parse}$, $\af{ε-parse}$, and $\af{∅-parse}$ are straightforward and can be found in our source code artifact.\jr{todo: reference this nicely}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν∪}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\\
%
\>[4]\AgdaFunction{δ∪}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⇔.refl}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaComment{--\ To\ make\ this\ work\ properly\ we\ have\ to\ do\ some\ ugly\ implicit\ parameter\ manipulation}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∪-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∪-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[35]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν∪}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊎-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∪-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[35]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ∪}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{c}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaFunction{◂ν∪}%
\>[13]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊎}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}%
\>[28]\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaFunction{◂ν∪}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ν∪}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}}\<%
\\
%
\>[8]\AgdaFunction{◂δ∪}%
\>[13]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}%
\>[32]\AgdaOperator{\AgdaFunction{⟺}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaFunction{◂δ∪}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{δ∪}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Q}\AgdaSymbol{\}}\<%
\end{code}
\begin{code}%
%
\>[8]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}◂∪-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◂∪-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{◂ν∪}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊎-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◂∪-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{◂δ∪}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν∗}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{\})}\<%
\\
%
\>[4]\AgdaFunction{δ∗}%
\>[997I]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\<%
\\
\>[997I][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[10]\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{))}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{map′-id-id}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaGeneralizable{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Dec.map′}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaFunction{id}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
%
\>[4]\AgdaFunction{map′-id-id}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\>[4]\AgdaFunction{map′-id-id}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\>[4]\AgdaFunction{∪-parse-rewrite}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{φ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ψ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaGeneralizable{w}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaGeneralizable{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊎-dec}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSpace{}%
\AgdaGeneralizable{w}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{∪-parse-rewrite}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{map′-id-id}\<%
\\
%
\>[4]\AgdaFunction{∪-parse-rewrite}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{trans}\AgdaSpace{}%
\AgdaFunction{map′-id-id}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{∪-parse-rewrite}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{w}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{\})}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{22}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`-parse\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{21}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∗-parse\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{21}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}·-parse\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{20}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∪-parse\AgdaUnderscore{}}}\<%
\\
%
\>[4]\AgdaComment{--\ To\ convince\ Agda\ this\ terminates,\ we\ need\ to\ use\ the\ identity:}\<%
\\
%
\>[4]\AgdaComment{--\ (φ\ ∪-parse\ ψ)\ w\ ≡\ φ\ w\ ⊎-dec\ ψ\ w}\<%
\\
%
\>[4]\AgdaComment{--\ That\ is\ easy\ to\ prove\ (see\ ∪-parse-rewrite\ above),\ but\ convincing\ Agda\ to\ use\ this\ is\ a\ bit\ difficult}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}∗-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{ν∗}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[27]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{δ∗}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·-parse}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊎-dec}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaComment{--\ So\ we\ just\ use\ the\ TERMINATING\ pragma\ for\ the\ code\ that\ we\ show\ in\ the\ paper.}\<%
\\
%
\>[4]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{TERMINATING}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}◂∗-parse\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaGeneralizable{Q}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◂∗-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}%
\>[28]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{ν∗}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◂∗-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}%
\>[28]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{δ∗}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{·-parse}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{φ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗-parse}}\AgdaSpace{}%
\AgdaBound{ψ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}

Using these combinators we can define a parser for the permissions language by
simply mapping each of the language combinators onto their respective parser
combinators.

\begin{code}[hide]%
%
\>[4]\AgdaFunction{permissions-parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaFunction{permissions}\<%
\\
%
\>[4]\AgdaFunction{read-parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaFunction{read}\<%
\\
%
\>[4]\AgdaFunction{write-parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaFunction{write}\<%
\\
%
\>[4]\AgdaFunction{execute-parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Parser}\AgdaSpace{}%
\AgdaFunction{execute}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{permissions-parse}%
\>[23]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{read-parse}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗-parse}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{write-parse}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗-parse}}\AgdaSpace{}%
\AgdaFunction{execute-parse}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{read-parse}%
\>[23]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaString{'-'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaString{'r'}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{write-parse}%
\>[23]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaString{'-'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaString{'w'}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{execute-parse}%
\>[23]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaString{'-'}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪-parse}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{`-parse}}\AgdaSpace{}%
\AgdaString{'x'}\AgdaSymbol{)}\<%
\end{code}

\subsection{Infinite Languages}

This permissions language is very simple. In particular, it is finite. In practice, many languages are inifinite, for which the basic combinators will not suffice. For example, file paths can be arbitrarily long on most systems.
Elliot~\cite{conal-languages} defines a Kleene star\jr{does this need citation?} combinator which enables him to specify regular languages such as file paths.

However, we want to go one step further, speficying and parsing context-free languages. Most practical programming languages are at least context-free, if not more complicated. One essential feature of many languages is the ability to recognize balanced brackets. A minimal example language with balanced brackets is the following:
%
\begin{grammar}
<brackets> ::= ε | `[' <brackets> `]' | <brackets> <brackets>
\end{grammar}
%
This is the language of all strings which consist of balanced square brackets. 
Many practical programming languages include some form of balanced brackets. Furthermore, this language is well known to be context-free and not regular. Thus, we need more powerful combinators.

We could try to naively transcribe the brackets grammar using our basic combinators, but Agda will justifiably complain that it is not terminating (here I've added a NON_TERMINATING pragma to make Agda to accept it any way).
%
\begin{code}%
%
\>[4]\AgdaSymbol{\{-\#}\AgdaSpace{}%
\AgdaKeyword{NON\AgdaUnderscore{}TERMINATING}\AgdaSpace{}%
\AgdaSymbol{\#-\}}\<%
\\
%
\>[4]\AgdaFunction{brackets}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ε}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'['}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaFunction{brackets}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{']'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaFunction{brackets}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaFunction{brackets}\<%
\end{code}
%
We need to find a different way to encode this recursive relation.

\begin{code}%
%
\>[4]\AgdaKeyword{postulate}\AgdaSpace{}%
\AgdaPostulate{μ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaFunction{bracketsμ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{μ}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{ε}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{'['}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{`}}\AgdaSpace{}%
\AgdaString{']'}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∪}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∗}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\<%
\end{code}

\begin{itemize}
\item μ cannot be implemented just like that
\item we need to restrict the Lang → Lang function that we take a fixed point over
\item polynomial functors would work, but our grammars are slightly different.
\item Luckily, our basic combinators with variables added also works
\item We can make this obvious to agda by defining a data type of descriptions a la gentle art of levitation.
\end{itemize}

\endinput

% For starters, we define some structure on this definition of language in
% \cref{fig:combinators}. First, Languages form a semiring, with union
% $\af{\un{}∪\un{}}$, concatenation $\af{\un{}∗\un{}}$, the empty language
% $\af{∅}$ which is the unit of union, and the language which only includes the
% empty string $\af{ε}$ which is the unit of concatenation. Furthermore the
% $\af{`\un}$ combinator defines a language which contains exactly the string
% consisting of a single given character. Finally, the scalar multiplication
% $\af{\un{}·\un{}}$ combinator injects an Agda type into a language. The purpose
% of this combinator will become clearer in later sections\jr{mention specific sections}.

% \subsection{Decidability}

% From our type theoretic perspective, parsing a string is the same thing as producing an element of the result type of a language for that given input string, or showing that no such element can exist. In Agda, we encode this using the following \af{Dec} data type which is parameterized by a type \ab{A} and contains a constructor \ac{yes} for when you can produce an element of \ab{A} or \ac{no} if you can show that no such element exists.
% \begin{code}
% data Dec (A : Type) : Type where
    % yes : A → Dec A
    % no : (A → ⊥) → Dec A
% \end{code}
% Sometimes we want to change the parameter type of a \af{Dec}. For that we need to provide conversion functions between the old and the new type in both ways.
% \begin{code}
% map? : (A ↔ B) → Dec A → Dec B
% map? f (yes x) = yes (to f x)
% map? f (no ¬A) = no λ x → ¬A (from f x)
% \end{code}
% \begin{code}[hide]
% ⌊_⌋ : Dec A → Type
% ⌊_⌋ {A} _ = A

% _×?_ : Dec A → Dec B → Dec (A × B)
% yes x ×? yes y = yes (x , y)
% yes _ ×? no ¬y = no λ (_ , y) → ¬y y
% no ¬x ×? _ = no λ (x , _) → ¬x x

% _⊎?_ : Dec A → Dec B → Dec (A ⊎ B)
% yes x ⊎? y = yes (inl x)
% no x ⊎? yes y = yes (inr y)
% no ¬x ⊎? no ¬y = no λ where
    % (inl x) → ¬x x
    % (inr y) → ¬y y

% _≟_ : (c : Char) → (c′ : Char) → Dec (c ≡ c′)
% `a ≟ `a = yes refl
% `a ≟ `b = no λ ()
% `a ≟ `c = no λ ()
% `a ≟ `0 = no λ ()
% `a ≟ `1 = no λ ()
% `b ≟ `a = no λ ()
% `b ≟ `b = yes refl
% `b ≟ `c = no λ ()
% `b ≟ `0 = no λ ()
% `b ≟ `1 = no λ ()
% `c ≟ `a = no λ ()
% `c ≟ `b = no λ ()
% `c ≟ `c = yes refl
% `c ≟ `0 = no λ ()
% `c ≟ `1 = no λ ()
% `0 ≟ `a = no λ ()
% `0 ≟ `b = no λ ()
% `0 ≟ `c = no λ ()
% `0 ≟ `0 = yes refl
% `0 ≟ `1 = no λ ()
% `1 ≟ `a = no λ ()
% `1 ≟ `b = no λ ()
% `1 ≟ `c = no λ ()
% `1 ≟ `0 = no λ ()
% `1 ≟ `1 = yes refl
% `a ≟ `[ = no λ ()
% `a ≟ `] = no λ ()
% `b ≟ `[ = no λ ()
% `b ≟ `] = no λ ()
% `c ≟ `[ = no λ ()
% `c ≟ `] = no λ ()
% `0 ≟ `[ = no λ ()
% `0 ≟ `] = no λ ()
% `1 ≟ `[ = no λ ()
% `1 ≟ `] = no λ ()
% `[ ≟ `a = no λ ()
% `[ ≟ `b = no λ ()
% `[ ≟ `c = no λ ()
% `[ ≟ `0 = no λ ()
% `[ ≟ `1 = no λ ()
% `[ ≟ `[ = yes refl
% `[ ≟ `] = no λ ()
% `] ≟ `a = no λ ()
% `] ≟ `b = no λ ()
% `] ≟ `c = no λ ()
% `] ≟ `0 = no λ ()
% `] ≟ `1 = no λ ()
% `] ≟ `[ = no λ ()
% `] ≟ `] = yes refl

% \end{code}

\subsection{Grammars}\label{sec:gram-and-parsing}

We have seen in \cref{ex:non-context-free} that our definition of language is very general, comprising even context-sensitive languages. Parsing such languages automatically poses a significant challenge. Hence, we side-step this problem by restricting the scope of our parsers to a smaller well-defined subset of languages. In this subsection, we consider a subset of regular languages without Kleene star (i.e., closure under concatenation). In \cref{sec:context-free}, we extend this class of languages to include fixed points which subsume the Kleene star.

\begin{code}[hide]%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{◆}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\begin{code}%
\>[0][@{}l@{\AgdaIndent{1}}]%
\>[4]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type₁}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\>[8]\AgdaInductiveConstructor{ε}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{`\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}·\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}∪\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}∗\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\end{code}

This syntax maps directly onto the semantics we defined in \cref{fig:combinators}.

\begin{code}[hide]%
%
\>[4]\AgdaFunction{typeOfDec}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Type}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
%
\>[4]\AgdaFunction{typeOfDec}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{A}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaOperator{\AgdaFunction{⟦\AgdaUnderscore{}⟧}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{◇.∅}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaInductiveConstructor{ε}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{◇.ε}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◇.`}}\AgdaSpace{}%
\AgdaBound{c}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{typeOfDec}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◇.·}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◇.∪}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◇.∗}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\<%
\end{code}

\subsection{Parsing}

To facilitate proving the inclusion of strings in a language, we start by decomposing the problem. A string is either empty or a character followed by the tail of the string. We can decompose the problem of string inclusion along the same dimensions. First, we define nullability $ν$ as the inclusion of the empty string in a language as follows:
\begin{code}%
%
\>[4]\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitive{Type}\<%
\\
%
\>[4]\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\<%
\end{code}
Second, we define the derivative $δ$ of a language $ℒ$ with respect to the character $c$ to be all the suffixes of the words in $ℒ$ which start with the $c$.
\begin{code}%
%
\>[4]\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Lang}\<%
\\
%
\>[4]\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}
The relevance of these definitions is shown by \cref{thm:nullability-after-derivatives}.
\begin{theorem}\label{thm:nullability-after-derivatives}
Nullability after repeated derivatives fully captures what a language is. Formally, we state this as follows:
\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν∘foldlδℒ≡ℒ}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\end{code}
\begin{code}%
\>[4][@{}l@{\AgdaIndent{1}}]%
\>[8]\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∘}}\AgdaSpace{}%
\AgdaFunction{foldl}\AgdaSpace{}%
\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaGeneralizable{ℒ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaGeneralizable{ℒ}\<%
\end{code}
\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν∘foldlδℒ≡ℒ′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Lang}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{foldl}\AgdaSpace{}%
\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
%
\>[4]\AgdaFunction{ν∘foldlδℒ≡ℒ′}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\>[4]\AgdaFunction{ν∘foldlδℒ≡ℒ′}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ν∘foldlδℒ≡ℒ′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaKeyword{postulate}\AgdaSpace{}%
\AgdaPostulate{funext}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{ℓ₁}\AgdaSpace{}%
\AgdaBound{ℓ₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Level}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ₁}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitive{Set}\AgdaSpace{}%
\AgdaBound{ℓ₂}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{Q}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{Q}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaFunction{ν∘foldlδℒ≡ℒ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{ℒ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{funext}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν∘foldlδℒ≡ℒ′}\AgdaSpace{}%
\AgdaBound{ℒ}\AgdaSymbol{)}\<%
\end{code}
\end{theorem}

\begin{code}%
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPostulate{Char}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Exp}\<%
\\
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaGeneralizable{w}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaGeneralizable{w}\<%
\\
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{◇δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaGeneralizable{w}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaGeneralizable{c}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaGeneralizable{w}\<%
\end{code}

\begin{code}[hide]%
%
\>[4]\AgdaFunction{map'}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
%
\>[4]\AgdaFunction{map'}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{map′}\<%
\end{code}
\begin{code}%
%
\>[4]\AgdaFunction{parse}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Exp}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{w}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{String}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{⟦}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⟧}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{parse}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e}\<%
\\
%
\>[4]\AgdaFunction{parse}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{map'}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{parse}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{w}\AgdaSymbol{)}\<%
\end{code}

\subsection{Nullability}

\begin{lemma}
Two languages, $\ab{ℒ₁}$ and $\ab{ℒ₂}$, are nullable if and only if their concatenation, $\ab{ℒ₁}~\af{◇.∗}~\ab{ℒ₂}$, is nullable. 
\begin{code}%
%
\>[4]\AgdaFunction{ν∗}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaGeneralizable{ℒ₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaGeneralizable{ℒ₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇔}}\AgdaSpace{}%
\AgdaFunction{◇ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaGeneralizable{ℒ₁}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{◇.∗}}\AgdaSpace{}%
\AgdaGeneralizable{ℒ₂}\AgdaSymbol{)}\<%
\end{code}
\begin{code}[hide]%
%
\>[4]\AgdaFunction{ν∗}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{mk⇔}\AgdaSpace{}%
\AgdaSymbol{(λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{\}}\<%
\end{code}
\end{lemma}

\begin{code}%
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaInductiveConstructor{ε}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e}\<%
\\
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⊎-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e₁}\<%
\\
%
\>[4]\AgdaFunction{ν}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{Dec.map}\AgdaSpace{}%
\AgdaFunction{ν∗}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×-dec}}\AgdaSpace{}%
\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\<%
\end{code}

\subsection{Derivation}

\begin{code}%
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\<%
\\
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaInductiveConstructor{ε}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\<%
\\
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{c}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{c₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{ε}\AgdaSpace{}%
\AgdaComment{--\ a\ bit\ interesting}\<%
\\
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{e}\<%
\\
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{e₁}\<%
\\
%
\>[4]\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{ν}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{δ}\AgdaSpace{}%
\AgdaBound{c}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaComment{--\ interesting}\<%
\end{code}

The proofs are very straightforward:

\begin{code}%
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaBound{u}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{v}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[4]\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{δ-sound}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaBound{y}\<%
\end{code}

\begin{code}%
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{c}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x₁}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{e}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∪}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∷}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₁}\AgdaSpace{}%
\AgdaSymbol{(\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaBound{e}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{e}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{∗}}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{inj₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaFunction{δ-complete}\AgdaSpace{}%
\AgdaBound{e₁}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)}\<%
\end{code}

% \begin{code}[hide]
% module Simple where
% \end{code}
% \begin{code}
%     data Gram : Lang → Type₁ where
%         ∅     :                       Gram (λ _ → ⊥)
%         ε     :                       Gram (λ w → w ≡ [])
%         char  : (c : Char)         →  Gram (λ w → w ≡ c ∷ [])
%         _·_   : Dec A → Gram ℒ     →  Gram (λ w → A × ℒ w)
%         _∪_   : Gram ℒ₁ → Gram ℒ₂  →  Gram (λ w → ℒ₁ w ⊎ ℒ₂ w)
%         _∗_   : Gram ℒ₁ → Gram ℒ₂
%               → Gram (λ w → Σ String λ u → Σ String λ v → (w ≡ u ++ v) × ℒ₁ u × ℒ₂ v)
%         _◃_   : (ℒ₁ ⇔ ℒ₂) → Gram ℒ₁ → Gram ℒ₂
% \end{code}
% \begin{code}[hide]
%     variable G G₁ G₂ : Gram ℒ
% \end{code}
% \begin{remark}
% The \af{Gram} data type is parameterized by its language. This ties the constructors directly to their semantics.
% \end{remark}
% 
% By recursion over this data type of grammars, we can define a decision procedure for nullability and derivative function; both are correct by construction.
% \begin{code}
%     ν? : Gram ℒ → Dec (ν ℒ)
%     δ? : Gram ℒ → (c : Char) → Gram (δ ℒ c)
% \end{code}
% \begin{code}[hide]
%     ν∗ : (ν ℒ₁ × ν ℒ₂) ↔ Σ String λ u → Σ String λ v → ([] ≡ (u ++ v)) × ℒ₁ u × ℒ₂ v
%     to ν∗ (x , y) = [] , [] , refl , x , y
%     from ν∗ ([] , [] , refl , x , y) = x , y
% 
%     ν? ∅ = no λ ()
%     ν? ε = yes refl
%     ν? (char c) = no λ ()
%     ν? (x · G) = x ×? ν? G
%     ν? (G₁ ∪ G₂) = ν? G₁ ⊎? ν? G₂
%     ν? (G₁ ∗ G₂) = map? ν∗ (ν? G₁ ×? ν? G₂)
%     ν? (f ◃ G₂) = map? f (ν? G₂)
% \end{code}
% \begin{code}[hide]
%     δ? ∅ c = ∅
%     δ? ε c = record { to = λ () ; from = λ () } ◃ ∅
%     δ? (char c′) c with c ≟ c′
%     ... | yes refl = (λ { {[]} → record { to = λ _ → refl ; from = λ _ → refl } ; {_ ∷ _} → record { to = λ () ; from = λ () }}) ◃ ε
%     ... | no ¬c≡c′ = (λ { {[]} → record { to = λ () ; from = λ { refl → ¬c≡c′ refl }} ; {_ ∷ _} → record { to = λ () ; from = λ () }}) ◃ ∅
%     δ? (A · G) c = A · δ? G c
%     δ? (G₁ ∪ G₂) c = δ? G₁ c ∪ δ? G₂ c
%     δ? (G₁ ∗ G₂) c = (record { to = λ { (inl (u , v , refl , x , y)) → (c ∷ u) , v , refl , x , y ; (inr (x , y)) → [] , (c ∷ _) , refl , x , y } ; from = λ { ([] , _ , refl , x , y) → inr (x , y) ; ((_ ∷ u) , v , refl , x , y) → inl (u , v , refl , x , y) } } ) ◃ ((δ? G₁ c ∗ G₂) ∪ (ν? G₁ · δ? G₂ c))
%     δ? (f ◃ G₂) c = f ◃ δ? G₂ c
% 
%     -- δ?↔δ : ⟦ δ? c G ⟧ w ↔ δ c ⟦ G ⟧ w
% \end{code}
% \begin{code}[hide]
%     -- to (δ?↔δ {c} {G = ` c′}) x with c ≟ c′
%     -- to (δ?↔δ {c} {` .c}) refl | yes refl = refl
%     -- to (δ?↔δ {_} {` _}) () | no _
%     -- to (δ?↔δ {G = A · G}) (x , y) = x , to δ?↔δ y
%     -- to (δ?↔δ {G = G₁ ∪ G₂}) (inl x) = inl (to δ?↔δ x)
%     -- to (δ?↔δ {G = G₁ ∪ G₂}) (inr x) = inr (to δ?↔δ x)
%     -- to (δ?↔δ {c} {G = G₁ ▹ G₂}) (inl (u , v , refl , x , y)) = (c ∷ u) , v , refl , to δ?↔δ x , y
%     -- to (δ?↔δ {c} {G = G₁ ▹ G₂} {w}) (inr (π₁ , π₂)) = [] , (c ∷ w) , refl , π₁ , to δ?↔δ π₂
%     -- from (δ?↔δ {c} {G = ` c′}) x with c ≟ c′
%     -- from (δ?↔δ {c} {` c}) refl | yes refl = refl
%     -- from (δ?↔δ {c} {` .c}) refl | no ¬c≡c = ¬c≡c refl
%     -- from (δ?↔δ {G = A · G}) (π₁ , π₂) = π₁ , from δ?↔δ π₂
%     -- from (δ?↔δ {G = G ∪ G₁}) (inl x) = inl (from δ?↔δ x)
%     -- from (δ?↔δ {G = G ∪ G₁}) (inr x) = inr (from δ?↔δ x)
%     -- from (δ?↔δ {c} {G = G ▹ G₁}) ([] , (.c ∷ v) , refl , x , y) = inr (x , from δ?↔δ y)
%     -- from (δ?↔δ {c} {G = G ▹ G₁}) ((.c ∷ u) , v , refl , x , y) = inl (u , v , refl , from δ?↔δ x , y)
%     transport : {ℓ₁ : Level} {A : Set ℓ₁} {B : Set ℓ₁} → A ≡ B → A → B
%     transport refl x = x
% \end{code}
% Together, decidable nullability and the derivative function can be combined to decide whether any string is in the language described by a grammar.
% \begin{code}
%     parse : Gram ℒ → (w : String) → Dec (ℒ w)
%     parse G [] = ν? G
%     parse G (c ∷ w) = parse (δ? G c) w
% \end{code}
% Thus, we have defined a parser for our simple grammars.

% A language is a set of strings $\mathbb{2}^{(\af{List}~\af{Token})}$.
% 
% 
% \begin{code}[hide]
% Lang : Set₁
% \end{code}
% \begin{code}
% Lang = List Token → Set
% \end{code}
% 
% This type has a very rich structure. It forms an ... algebra with union and intersection and a semiring with union and sequential composition.
% 
% \begin{code}
% ∅ : Lang
% ∅ _ = ⊥
% \end{code}
% 
% Going beyond work by Elliot, we can try to define context-free grammars.
% Unfortunately, we quickly run into issues due to nontermination. It is not easy
% to show that a grammar defined in this way is well-founded. To solve this issue
% we can use guarded type theory, in our case provided by guarded cubical Agda.
% This allows us to define arbitrary fixed points of languages.
% 
% \begin{code}
% fueled : (Lang → Lang) → ℕ → Lang
% fueled f 0 = ∅
% fueled f (suc n) = f (fueled f n)
% \end{code}
% 
% \begin{code}
% fix : (Lang → Lang) → Lang
% fix f w = ∃[ n ] fueled f n w
% \end{code}
